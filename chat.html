<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat entre Personas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f2f5;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .header {
      background: #4a69bd;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 18px;
    }
    #chat-box {
      height: 400px;
      overflow-y: auto;
      padding: 15px;
      background: #f9f9f9;
    }
    .message {
      margin-bottom: 10px;
      padding: 8px 12px;
      border-radius: 10px;
      max-width: 80%;
    }
    .mine {
      background: #dcf8c6;
      margin-left: auto;
      text-align: right;
    }
    .theirs {
      background: #e2e2e2;
    }
    .input-area {
      display: flex;
      padding: 10px;
      background: white;
    }
    #message-input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 20px;
      outline: none;
    }
    #send-btn {
      margin-left: 10px;
      padding: 10px 15px;
      background: #4a69bd;
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
    }
    #send-btn:hover {
      background: #3a59a8;
    }
    .timestamp {
      font-size: 10px;
      color: #777;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">ðŸ’¬ Chat entre Personas</div>
    <div id="chat-box"></div>
    <div class="input-area">
      <input type="text" id="message-input" placeholder="Escribe tu mensaje..." />
      <button id="send-btn">Enviar</button>
    </div>
  </div>

  <script>
    const chatBox = document.getElementById('chat-box');
    const messageInput = document.getElementById('message-input');
    const sendBtn = document.getElementById('send-btn');

    // Generar un ID Ãºnico para el usuario actual (solo para diferenciar en la misma mÃ¡quina)
    let userId = localStorage.getItem('userId');
    if (!userId) {
      userId = 'user-' + Math.random().toString(36).substr(2, 9);
      localStorage.setItem('userId', userId);
    }

    // Cargar mensajes al iniciar
    loadMessages();

    // Enviar mensaje al presionar "Enviar"
    sendBtn.addEventListener('click', sendMessage);
    messageInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    function sendMessage() {
      const text = messageInput.value.trim();
      if (text === '') return;

      const message = {
        id: Date.now(),
        text: text,
        sender: userId,
        timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
      };

      // Guardar en localStorage
      const messages = JSON.parse(localStorage.getItem('chatMessages') || '[]');
      messages.push(message);
      localStorage.setItem('chatMessages', JSON.stringify(messages));

      displayMessage(message, true);
      messageInput.value = '';
    }

    function displayMessage(msg, isMine = false) {
      const msgDiv = document.createElement('div');
      msgDiv.classList.add('message');
      msgDiv.classList.add(isMine ? 'mine' : 'theirs');

      msgDiv.innerHTML = `
        <div>${msg.text}</div>
        <div class="timestamp">${msg.timestamp}</div>
      `;

      chatBox.appendChild(msgDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function loadMessages() {
      const messages = JSON.parse(localStorage.getItem('chatMessages') || '[]');
      chatBox.innerHTML = '';
      messages.forEach(msg => {
        const isMine = msg.sender === userId;
        displayMessage(msg, isMine);
      });
    }

    // Detectar cambios en otras pestaÃ±as
    window.addEventListener('storage', (e) => {
      if (e.key === 'chatMessages') {
        loadMessages();
      }
    });
  </script>
</body>
</html>